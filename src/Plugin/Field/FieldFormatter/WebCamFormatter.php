<?php
namespace Drupal\webcam_field\Plugin\Field\FieldFormatter;

use Drupal\Core\Field\FieldItemListInterface;
use Drupal\Core\Field\FormatterBase;
use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Url;
use Drupal\webcam_field\Helper\WebcamHelper;
/**
 * Plugin implementation of the 'web_cam_formatter' formatter.
 *
 * @FieldFormatter(
 *   id = "web_cam_formatter",
 *   label = @Translation("Webcam image"),
 *   field_types = {
 *     "webcam_field_type"
 *   }
 * )
 */
class WebCamFormatter extends FormatterBase {

  /**
   * {@inheritdoc}
   */
  public static function defaultSettings() {
    return [
      // Implement default settings.
    ] + parent::defaultSettings();
  }

  /**
   * {@inheritdoc}
   */
  public function settingsForm(array $form, FormStateInterface $form_state) {
    return [
      // Implement settings form.
    ] + parent::settingsForm($form, $form_state);
  }

  /**
   * {@inheritdoc}
   */
  public function settingsSummary() {
    $summary = [];
    // Implement settings summary.

    return $summary;
  }

  /**
   * {@inheritdoc}
   */
  public function viewElements(FieldItemListInterface $items, $langcode) {
    $elements = [];
    $user = \Drupal::currentUser();
    if ($items[0] === NULL || !$user->hasPermission('view webcam')) {
      return [];
    }
    $field_info = $items[0]->getParent();
    $entity = $field_info->getEntity();
    $id = $entity->id();
    $field_name = $field_info->getName();
    $type = $entity->getEntityTypeId();
    //ksm($type);


    foreach ($items as $delta => $item) {
      $url = Url::fromRoute('webcam_field.update', array(
        'entity_type' => $type,
        'entity_id' => $id,
        'field_name' => $field_name,
        'delta' => $delta,
      ));

      $data = new WebcamHelper();
      $imgSrc = $data->cache($type, $id, $field_name, $delta, $item);
      // return $data;

      if($imgSrc == false){
        $imgSrc = "data:image/png;base64,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B1W+9Or4haKbrplKLz6l8zrgre3XATdUCuCrBa8Dnn7r2dVfBxxysHPeqUtvPj9k72H5rwNeMvL1uZFbfqGz4IGKZVTtRn4A6285ip7rbnqqbB+wKBvv9Cpbfn+Vbox4FvxSvK078m/Bnbcvy7nt375mcWbpvUlJ8x/N7GGGsHB/5wlEpQeHl3+6NPNOyMvJhp+o/E7IsO1Lk43cmL11Dtz33QWVA5jTjaItL8t5RaikjGrdKAhgky1H0eMr544KYEk23rpx0ZJf7Y+iX1fqhs8DMktaYbu3ymo6xfi82Du0suIjmwAyRitSr/adFwkgk7b39/M66btnuuIZBJBju6uoBQggAggCiACCACKAIIAIIAggAggCiACCACKAIIAIIAggAggCiACCACKAIIAIIAggAggCiACCACKAIIAIIAIIAogAggAigCCACCAIIAIIAogAggAigCCACCAIIAIIAogAggAigCCACCAIIAIIAogAggAigCCACCAIIAKIAIIAIoAggAggCCACCAKIAIIAIoAggAggCCACCAKIAIIAIoAggAggCCACCAKIAIIAIoAggAggCCACiACCACKAIIAIIAggAggCiACCACKAIIAIIAggAggCiACCACKAIIAIIAggAggCiACCACKAIIAIIAggAggCiAAigCCACCAIIAIIAogAggAigCCACCAIIAIIAogAggAigCCACCAIIAIIAogAggAigCCACCAIIAIIAogAggAigAggCCACCAKIAIIAIoAggAggCCACCAKIAIIAIoAggAggCCACCAKIAIIAIoAggAggCCACCAKIAIIAIoAIIAggAggCiACCACKAIIAIIAggAggCiACCACKAIIAIIAggAggCiACCACKAIIAIIAggAggCiACCACKAIIAIIAIIAogAggAigCCACCAcnwEMIWxJH386JHY32NKuL30TM92YuG+FcP5YNnR7CAuPQQBDRqWWb5xsAN+e8G26td512DjZ6t6epQAurnTrf/UCuO/M8PBE2/JQrdthwgEc7oYA9pbOTgBbK000gO+E4zmAw904AQK4sHYPtgjgMdoHnMUArglhwZcigIWd+UoGcPLPeWYrgMfoWbAACqAACqAAZhz5Q/dZyabU0h3JsqpPQjYl6/99YOn3OsvWjwzghyVPkH4cL7nsyOiruSSED6Lo0PLOGS4+2lt+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";
      }

      $htmlid = 'webcam-'. $type . '-'. $field_name. '-' .$delta;
      $data = '<div id="' . $htmlid .
        # '" data-entity--id="' . $id .
        #  '" data-entity--type="'. $type .
        #   '" data-field--name="'. $field_name .
        #   '" data-field--delta="' . $delta .
        '" data-timeout="' . $item->refresh_rate .
        '" data-url="' . $url->tostring() .
        '" data-imgdata="' . $imgSrc .
        '" class="webcam-content"><div class="webcam-image"></div></div>';
      $elements[$delta] = ['#markup' => $data];
    }
    $elements['#attached']['library'][] = 'webcam_field/webcam';

    return $elements;
  }


}
